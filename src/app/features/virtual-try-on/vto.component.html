<div class="max-w-5xl mx-auto">
  <div class="text-center mb-12">
    <h1 class="text-4xl font-bold text-gold mb-2">AI Virtual Stylist</h1>
    <p class="text-lg text-brand-light/80">Upload your photo and see your new look in seconds.</p>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
    <!-- Controls Column -->
    <div class="bg-black/30 p-6 rounded-lg shadow-lg">
      <!-- Step 1: Upload Image -->
      <div class="mb-8">
        <h2 class="text-2xl font-semibold text-gold mb-4 border-b border-gold/20 pb-2">Step 1: Upload Your Photo</h2>
        <label for="file-upload" class="cursor-pointer w-full h-48 border-2 border-dashed border-gray-600 rounded-lg flex flex-col items-center justify-center hover:border-gold transition-colors">
          @if (uploadedImage()) {
            <img [ngSrc]="uploadedImage()" alt="Uploaded preview" class="h-full w-full object-cover rounded-lg" width="400" height="400" priority>
          } @else {
            <svg class="w-12 h-12 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
            <span class="mt-2 text-gray-400">Click to upload</span>
          }
        </label>
        <input id="file-upload" type="file" class="hidden" (change)="onFileSelected($event)" accept="image/png, image/jpeg">
      </div>

      <!-- Step 2: Choose Style -->
      @if (uploadedImage()) {
        <div class="mb-8">
          <h2 class="text-2xl font-semibold text-gold mb-4 border-b border-gold/20 pb-2">Step 2: Choose Your Style</h2>
          <div class="grid grid-cols-2 gap-4">
            @for (style of stylePrompts; track style.name) {
              <button type="button" (click)="selectStyle(style)" [class]="'rounded-lg overflow-hidden border-2 transition-all text-left ' + (selectedStyle()?.name === style.name ? 'border-gold scale-105' : 'border-transparent hover:border-gold/50')">
                <img [ngSrc]="style.thumbnail" [alt]="style.name" class="w-full h-24 object-cover" width="200" height="200">
                <p class="text-center bg-black/50 p-2 text-sm">{{ style.name }}</p>
              </button>
            }
          </div>
        </div>
      }

      <!-- Step 3: Generate -->
      @if (uploadedImage() && selectedStyle()) {
        <div>
          <h2 class="text-2xl font-semibold text-gold mb-4 border-b border-gold/20 pb-2">Step 3: Generate!</h2>
          <button (click)="generateHairstyle()" [disabled]="isLoading()" class="w-full bg-gold text-brand-dark font-bold py-3 px-8 rounded-full hover:bg-yellow-300 transition-all duration-300 shadow-lg shadow-gold/20 disabled:bg-gray-500 disabled:cursor-not-allowed">
            @if (isLoading()) {
              <span class="flex items-center justify-center">
                <svg class="animate-spin -ml-1 mr-3 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                Generating...
              </span>
            } @else {
              <span>Apply Style</span>
            }
          </button>
        </div>
      }
    </div>

    <!-- Result Column -->
    <div class="bg-black/30 p-6 rounded-lg shadow-lg flex items-center justify-center min-h-[400px]">
      @if (isLoading()) {
        <div class="text-center">
          <p class="text-gold text-lg">Our AI stylist is working its magic...</p>
        </div>
      } @else if (error()) {
        <div class="text-center text-red-400 p-4 border border-red-400 rounded-lg">
          <p class="font-bold">Oops!</p>
          <p>{{ error() }}</p>
        </div>
      } @else if (generatedImage()) {
        <img [ngSrc]="generatedImage()" alt="Generated hairstyle" class="max-w-full max-h-[500px] rounded-lg shadow-2xl" width="500" height="500" priority>
      } @else {
        <div class="text-center text-gray-500">
          <p class="text-xl">Your new look will appear here.</p>
        </div>
      }
    </div>
  </div>
</div>